import { unscramble } from "botex";
import { useEffect, useRef, useState } from "preact/hooks";
import cx from "../../cx";
import style from "./Tel.module.scss";

const KEY = "162381698136";
const ENCODED = "B1774d01fe57e";

const Tel = () => {
	const [isOpen, setIsOpen] = useState(false);
	const wrapperRef = useRef<HTMLSpanElement | null>(null);

	const handleActivate = () => {
		setIsOpen(true);
	};

	const handleKeyDown = (e: KeyboardEvent) => {
		if (["Enter", " "].includes(e.key)) {
			handleActivate();
		}
	};

	const handleCopy = () => {
		navigator.clipboard.writeText(unscramble(ENCODED, KEY));
	};

	const handleWrite = () => {
		const mail = unscramble(ENCODED, KEY);
		const href = `mailto:${mail}`;
		window.location.href = href;
	};

	useEffect(() => {
		const clickHandler = (e: MouseEvent) => {
			if (!wrapperRef.current?.contains(e.target as Node | null)) {
				setIsOpen(false);
			}
		};
		const keyHandler = (e: KeyboardEvent) => {
			if (e.key === "Escape") {
				setIsOpen(false);
			}
		};
		if (isOpen) {
			document.addEventListener("click", clickHandler);
			document.addEventListener("keydown", keyHandler);
		}
		return () => {
			document.removeEventListener("click", clickHandler);
			document.removeEventListener("keydown", keyHandler);
		};
	}, [isOpen]);

	const handleFocus = () => setIsOpen(true);
	const handleBlur = () => setIsOpen(false);

	return (
		<span
			className={style.wrapper}
			ref={wrapperRef}
			onFocus={handleFocus}
			onBlur={handleBlur}
		>
			<a
				role="button"
				className={style.link}
				onClick={handleActivate}
				onKeyDown={handleKeyDown}
				tabIndex={0}
			>
				<svg
					className={style.svg}
					// width="675.108"
					// height="74.718"
					viewBox="0 0 675.108 74.718"
					xmlns="http://www.w3.org/2000/svg"
				>
					<g stroke="none" fill="currentColor">
						<path
							fillRule="evenodd"
							d="M 17.388 73.68 A 22.175 22.175 0 0 0 24.29 74.717 A 25.193 25.193 0 0 0 26.23 74.643 A 19.562 19.562 0 0 0 37.376 70.296 Q 42.792 65.875 45.686 57.494 A 43.481 43.481 0 0 0 46.504 54.849 Q 47.584 50.928 48.102 46.352 A 80.064 80.064 0 0 0 48.58 37.359 A 89.474 89.474 0 0 0 48.526 34.217 Q 48.364 29.599 47.714 25.545 A 48.928 48.928 0 0 0 45.686 17.277 Q 44.414 13.602 42.648 10.681 A 23.925 23.925 0 0 0 37.341 4.458 A 19.21 19.21 0 0 0 31.556 1.186 A 21.626 21.626 0 0 0 24.29 0.001 A 25.012 25.012 0 0 0 23 0.034 A 19.683 19.683 0 0 0 11.24 4.458 Q 5.789 8.914 2.895 17.277 Q 1.176 22.243 0.478 28.391 A 79.617 79.617 0 0 0 0 37.359 A 90.004 90.004 0 0 0 0.055 40.51 Q 0.217 45.142 0.866 49.206 A 49.11 49.11 0 0 0 2.895 57.494 A 41.598 41.598 0 0 0 3.231 58.431 Q 6.095 66.125 11.204 70.296 A 19.004 19.004 0 0 0 17.388 73.68 Z M 24.29 68.751 A 13.793 13.793 0 0 0 35.315 63.582 A 20.858 20.858 0 0 0 37.429 60.53 A 30.392 30.392 0 0 0 40.307 53.418 Q 41.288 49.851 41.747 45.541 A 77.382 77.382 0 0 0 42.152 37.359 Q 42.152 27.416 40.004 20.367 Q 37.856 13.318 33.86 9.589 A 13.536 13.536 0 0 0 24.29 5.86 A 13.71 13.71 0 0 0 13.354 11.023 A 21.254 21.254 0 0 0 11.186 14.152 Q 7.822 20.015 6.836 29.188 A 76.667 76.667 0 0 0 6.428 37.359 Q 6.428 45.263 7.786 51.327 A 40.767 40.767 0 0 0 8.576 54.333 Q 10.279 59.905 13.14 63.38 A 16.966 16.966 0 0 0 14.72 65.058 Q 18.715 68.751 24.29 68.751 Z"
						/>
						<path d="M 78.587 0.995 L 85.512 0.995 L 85.512 73.723 L 78.871 73.723 L 78.871 7.955 L 78.445 7.955 L 61.4 19.284 L 61.4 12.394 L 78.587 0.995 Z" />
						<path d="M 107.458 55.541 L 113.885 55.541 A 13.759 13.759 0 0 0 115.309 61.068 A 13.236 13.236 0 0 0 118.431 65.04 Q 122.657 68.751 128.907 68.751 A 17.37 17.37 0 0 0 134.176 67.974 A 15.352 15.352 0 0 0 137.571 66.425 A 16.22 16.22 0 0 0 143.52 60.033 A 18.63 18.63 0 0 0 145.565 53.04 A 22.829 22.829 0 0 0 145.668 50.853 A 21.459 21.459 0 0 0 145.037 45.695 A 17.45 17.45 0 0 0 143.36 41.46 Q 141.087 37.394 137.199 35.086 A 16.617 16.617 0 0 0 129.081 32.787 A 19.851 19.851 0 0 0 128.481 32.778 A 20.92 20.92 0 0 0 128.277 32.777 A 20.77 20.77 0 0 0 121.307 33.985 A 22.346 22.346 0 0 0 118.269 35.307 A 16.423 16.423 0 0 0 115.448 37.181 L 108.807 36.329 L 113.175 0.995 L 149.113 0.995 L 149.113 6.961 L 118.75 6.961 L 115.838 31.286 L 116.194 31.286 A 17.939 17.939 0 0 1 119.573 29.072 A 22.986 22.986 0 0 1 122.071 27.984 A 21 21 0 0 1 129.404 26.705 A 22.943 22.943 0 0 1 137.107 27.973 A 21.086 21.086 0 0 1 140.963 29.795 Q 146.094 32.884 149.095 38.3 Q 152.096 43.715 152.096 50.747 Q 152.096 57.636 149.095 63.051 Q 146.094 68.467 140.856 71.592 A 22.232 22.232 0 0 1 131.17 74.625 A 27.306 27.306 0 0 1 128.907 74.717 A 25.555 25.555 0 0 1 122.653 73.979 A 21.287 21.287 0 0 1 118.058 72.249 A 19.652 19.652 0 0 1 110.459 65.448 A 18.618 18.618 0 0 1 107.518 56.618 A 22.511 22.511 0 0 1 107.458 55.541 Z" />
						<path d="M 176.279 73.723 L 169.283 73.723 L 202.415 7.423 L 202.415 6.961 L 164.24 6.961 L 164.24 0.995 L 209.375 0.995 L 209.375 7.245 L 176.279 73.723 Z" />
						<path d="M 222.337 55.541 L 228.765 55.541 A 13.759 13.759 0 0 0 230.188 61.068 A 13.236 13.236 0 0 0 233.31 65.04 Q 237.536 68.751 243.786 68.751 A 17.37 17.37 0 0 0 249.055 67.974 A 15.352 15.352 0 0 0 252.451 66.425 A 16.22 16.22 0 0 0 258.399 60.033 A 18.63 18.63 0 0 0 260.444 53.04 A 22.829 22.829 0 0 0 260.547 50.853 A 21.459 21.459 0 0 0 259.916 45.695 A 17.45 17.45 0 0 0 258.239 41.46 Q 255.966 37.394 252.078 35.086 A 16.617 16.617 0 0 0 243.96 32.787 A 19.851 19.851 0 0 0 243.36 32.778 A 20.92 20.92 0 0 0 243.157 32.777 A 20.77 20.77 0 0 0 236.186 33.985 A 22.346 22.346 0 0 0 233.148 35.307 A 16.423 16.423 0 0 0 230.327 37.181 L 223.686 36.329 L 228.054 0.995 L 263.992 0.995 L 263.992 6.961 L 233.63 6.961 L 230.718 31.286 L 231.073 31.286 A 17.939 17.939 0 0 1 234.453 29.072 A 22.986 22.986 0 0 1 236.95 27.984 A 21 21 0 0 1 244.283 26.705 A 22.943 22.943 0 0 1 251.986 27.973 A 21.086 21.086 0 0 1 255.842 29.795 Q 260.973 32.884 263.974 38.3 Q 266.975 43.715 266.975 50.747 Q 266.975 57.636 263.974 63.051 Q 260.973 68.467 255.735 71.592 A 22.232 22.232 0 0 1 246.05 74.625 A 27.306 27.306 0 0 1 243.786 74.717 A 25.555 25.555 0 0 1 237.532 73.979 A 21.287 21.287 0 0 1 232.937 72.249 A 19.652 19.652 0 0 1 225.338 65.448 A 18.618 18.618 0 0 1 222.397 56.618 A 22.511 22.511 0 0 1 222.337 55.541 Z" />
						<path d="M 297.586 0.995 L 304.51 0.995 L 304.51 73.723 L 297.87 73.723 L 297.87 7.955 L 297.444 7.955 L 280.398 19.284 L 280.398 12.394 L 297.586 0.995 Z" />
						<path d="M 335.725 73.723 L 328.729 73.723 L 361.861 7.423 L 361.861 6.961 L 323.686 6.961 L 323.686 0.995 L 368.821 0.995 L 368.821 7.245 L 335.725 73.723 Z" />
						<path d="M 426.527 19.177 L 419.993 19.177 A 18.85 18.85 0 0 0 418.242 13.784 A 16.092 16.092 0 0 0 415.27 9.696 A 12.471 12.471 0 0 0 408.521 6.246 A 17.897 17.897 0 0 0 405.292 5.967 A 15.179 15.179 0 0 0 397.463 7.976 Q 393.931 10.048 391.442 14.259 A 30.239 30.239 0 0 0 388.451 21.454 Q 386.528 28.264 386.506 37.785 L 386.968 37.785 A 19.457 19.457 0 0 1 391.46 32.192 A 20.915 20.915 0 0 1 397.728 28.499 A 20.676 20.676 0 0 1 405.114 27.167 A 20.956 20.956 0 0 1 416.229 30.239 Q 421.272 33.311 424.29 38.655 A 23.428 23.428 0 0 1 427.164 47.927 A 29.049 29.049 0 0 1 427.309 50.853 A 25.643 25.643 0 0 1 425.12 61.437 A 25.024 25.024 0 0 1 424.45 62.821 A 22.201 22.201 0 0 1 416.424 71.521 Q 411.314 74.717 404.448 74.717 A 29.615 29.615 0 0 1 404.297 74.717 A 23.146 23.146 0 0 1 395.49 72.888 A 19.703 19.703 0 0 1 389.754 69.173 A 24.547 24.547 0 0 1 387.749 67.1 A 23.729 23.729 0 0 1 384.745 62.625 Q 383.324 59.922 382.28 56.535 Q 380.669 51.306 380.34 44.166 A 82.408 82.408 0 0 1 380.256 40.377 A 87.79 87.79 0 0 1 380.737 30.987 A 68.798 68.798 0 0 1 381.819 24.113 A 50.282 50.282 0 0 1 383.735 17.324 A 37.596 37.596 0 0 1 386.506 11.329 A 25.93 25.93 0 0 1 390.391 6.153 A 21.75 21.75 0 0 1 394.319 2.966 A 19.095 19.095 0 0 1 402.249 0.186 A 24.34 24.34 0 0 1 405.292 0.001 A 24.322 24.322 0 0 1 410.84 0.609 A 19.555 19.555 0 0 1 415.696 2.433 A 19.769 19.769 0 0 1 423.012 9.198 Q 425.817 13.531 426.527 19.177 Z M 404.297 68.751 A 15.999 15.999 0 0 0 409.979 67.76 A 14.863 14.863 0 0 0 412.802 66.336 Q 416.549 63.921 418.715 59.855 A 18.618 18.618 0 0 0 420.862 51.771 A 21.959 21.959 0 0 0 420.881 50.853 Q 420.881 45.917 418.715 41.904 A 16.988 16.988 0 0 0 412.802 35.512 A 15.358 15.358 0 0 0 405.035 33.148 A 18.576 18.576 0 0 0 404.297 33.133 Q 400.675 33.133 397.55 34.607 A 16.96 16.96 0 0 0 392.135 38.62 A 17.541 17.541 0 0 0 388.655 44.426 A 15.901 15.901 0 0 0 387.694 49.908 A 17.357 17.357 0 0 0 387.749 51.279 A 22.956 22.956 0 0 0 388.904 56.993 A 19.883 19.883 0 0 0 390.359 60.246 A 17.558 17.558 0 0 0 394.265 65.066 A 16.471 16.471 0 0 0 396.183 66.478 Q 399.787 68.751 404.297 68.751 Z" />
						<path d="M 487.5 19.177 L 480.966 19.177 A 18.85 18.85 0 0 0 479.215 13.784 A 16.092 16.092 0 0 0 476.243 9.696 A 12.471 12.471 0 0 0 469.494 6.246 A 17.897 17.897 0 0 0 466.265 5.967 A 15.179 15.179 0 0 0 458.436 7.976 Q 454.904 10.048 452.415 14.259 A 30.239 30.239 0 0 0 449.424 21.454 Q 447.501 28.264 447.479 37.785 L 447.941 37.785 A 19.457 19.457 0 0 1 452.433 32.192 A 20.915 20.915 0 0 1 458.701 28.499 A 20.676 20.676 0 0 1 466.087 27.167 A 20.956 20.956 0 0 1 477.202 30.239 Q 482.245 33.311 485.263 38.655 A 23.428 23.428 0 0 1 488.137 47.927 A 29.049 29.049 0 0 1 488.282 50.853 A 25.643 25.643 0 0 1 486.093 61.437 A 25.024 25.024 0 0 1 485.423 62.821 A 22.201 22.201 0 0 1 477.397 71.521 Q 472.287 74.717 465.421 74.717 A 29.615 29.615 0 0 1 465.27 74.717 A 23.146 23.146 0 0 1 456.463 72.888 A 19.703 19.703 0 0 1 450.727 69.173 A 24.547 24.547 0 0 1 448.722 67.1 A 23.729 23.729 0 0 1 445.718 62.625 Q 444.297 59.922 443.253 56.535 Q 441.642 51.306 441.313 44.166 A 82.408 82.408 0 0 1 441.229 40.377 A 87.79 87.79 0 0 1 441.71 30.987 A 68.798 68.798 0 0 1 442.792 24.113 A 50.282 50.282 0 0 1 444.708 17.324 A 37.596 37.596 0 0 1 447.479 11.329 A 25.93 25.93 0 0 1 451.364 6.153 A 21.75 21.75 0 0 1 455.292 2.966 A 19.095 19.095 0 0 1 463.222 0.186 A 24.34 24.34 0 0 1 466.265 0.001 A 24.322 24.322 0 0 1 471.813 0.609 A 19.555 19.555 0 0 1 476.669 2.433 A 19.769 19.769 0 0 1 483.985 9.198 Q 486.79 13.531 487.5 19.177 Z M 465.27 68.751 A 15.999 15.999 0 0 0 470.952 67.76 A 14.863 14.863 0 0 0 473.775 66.336 Q 477.522 63.921 479.688 59.855 A 18.618 18.618 0 0 0 481.835 51.771 A 21.959 21.959 0 0 0 481.854 50.853 Q 481.854 45.917 479.688 41.904 A 16.988 16.988 0 0 0 473.775 35.512 A 15.358 15.358 0 0 0 466.008 33.148 A 18.576 18.576 0 0 0 465.27 33.133 Q 461.648 33.133 458.523 34.607 A 16.96 16.96 0 0 0 453.108 38.62 A 17.541 17.541 0 0 0 449.628 44.426 A 15.901 15.901 0 0 0 448.667 49.908 A 17.357 17.357 0 0 0 448.722 51.279 A 22.956 22.956 0 0 0 449.877 56.993 A 19.883 19.883 0 0 0 451.332 60.246 A 17.558 17.558 0 0 0 455.238 65.066 A 16.471 16.471 0 0 0 457.156 66.478 Q 460.76 68.751 465.27 68.751 Z" />
						<path d="M 551.527 58.098 L 501.598 58.098 L 501.598 52.7 L 534.02 0.995 L 537.998 0.995 L 537.998 10.051 L 535.05 10.051 L 509.02 51.67 L 509.02 52.132 L 551.527 52.132 L 551.527 58.098 Z M 541.868 73.723 L 535.547 73.723 L 535.547 56.393 L 535.547 53.907 L 535.547 0.995 L 541.868 0.995 L 541.868 73.723 Z" />
						<path d="M 614.169 58.098 L 564.24 58.098 L 564.24 52.7 L 596.662 0.995 L 600.64 0.995 L 600.64 10.051 L 597.692 10.051 L 571.662 51.67 L 571.662 52.132 L 614.169 52.132 L 614.169 58.098 Z M 604.51 73.723 L 598.189 73.723 L 598.189 56.393 L 598.189 53.907 L 598.189 0.995 L 604.51 0.995 L 604.51 73.723 Z" />
						<path d="M 641.584 36.045 L 641.584 35.654 A 15.701 15.701 0 0 1 632.955 29.493 Q 629.688 24.894 629.723 19.035 A 20.75 20.75 0 0 1 629.723 18.899 Q 629.723 13.548 632.493 9.305 A 19.65 19.65 0 0 1 639.696 2.743 A 23.231 23.231 0 0 1 640.146 2.505 Q 644.993 0.001 651.101 0.001 Q 657.174 0.001 662.003 2.505 Q 666.833 5.008 669.656 9.305 A 17.473 17.473 0 0 1 672.51 18.697 A 20.926 20.926 0 0 1 672.515 19.035 Q 672.479 24.859 669.212 29.493 Q 665.945 34.127 660.618 35.654 L 660.618 36.045 Q 664.738 36.826 668.005 39.525 A 19.685 19.685 0 0 1 673.189 46.148 Q 675.107 50.072 675.107 54.582 A 17.903 17.903 0 0 1 672 64.898 A 20.858 20.858 0 0 1 664.954 71.312 A 25.286 25.286 0 0 1 663.477 72.089 A 26.037 26.037 0 0 1 655.503 74.434 A 33.22 33.22 0 0 1 651.101 74.717 A 31.53 31.53 0 0 1 644.33 74.018 A 25.336 25.336 0 0 1 638.708 72.089 A 22.563 22.563 0 0 1 633.114 68.316 A 19.875 19.875 0 0 1 630.185 64.898 Q 627.096 60.335 627.096 54.582 A 19.249 19.249 0 0 1 628.978 46.148 A 18.94 18.94 0 0 1 634.162 39.543 Q 637.465 36.862 641.584 36.045 Z M 651.101 68.751 Q 656.286 68.751 660.21 66.887 A 16.176 16.176 0 0 0 664.085 64.345 A 14.087 14.087 0 0 0 666.353 61.755 A 12.898 12.898 0 0 0 668.564 54.803 A 15.75 15.75 0 0 0 668.573 54.262 A 14.067 14.067 0 0 0 667.543 48.847 A 13.383 13.383 0 0 0 666.265 46.468 A 16.095 16.095 0 0 0 660.621 41.357 A 19.09 19.09 0 0 0 660.015 41.034 A 18.493 18.493 0 0 0 653.523 39.153 A 22.878 22.878 0 0 0 651.101 39.028 A 21.167 21.167 0 0 0 645.828 39.663 A 17.902 17.902 0 0 0 642.17 41.034 A 16.782 16.782 0 0 0 637.692 44.279 A 15.343 15.343 0 0 0 635.92 46.468 A 13.649 13.649 0 0 0 633.632 53.99 A 16.493 16.493 0 0 0 633.63 54.262 A 13.904 13.904 0 0 0 634.4 58.942 A 12.655 12.655 0 0 0 635.814 61.755 Q 637.998 65.022 641.957 66.887 A 19.29 19.29 0 0 0 647.367 68.486 A 25.367 25.367 0 0 0 651.101 68.751 Z M 651.101 33.346 A 17.204 17.204 0 0 0 655.614 32.773 A 14.7 14.7 0 0 0 658.736 31.535 Q 662.11 29.724 664.081 26.581 A 13.202 13.202 0 0 0 666.056 20.293 A 16.024 16.024 0 0 0 666.087 19.426 A 13.987 13.987 0 0 0 665.41 15.143 A 12.349 12.349 0 0 0 664.098 12.377 A 13.418 13.418 0 0 0 658.789 7.583 A 15.532 15.532 0 0 0 653.714 6.029 A 19.712 19.712 0 0 0 651.101 5.86 A 18.635 18.635 0 0 0 646.764 6.346 A 15.289 15.289 0 0 0 643.378 7.583 A 13.234 13.234 0 0 0 638.051 12.377 A 12.402 12.402 0 0 0 636.188 18.206 Q 636.15 18.736 636.15 19.283 A 16.026 16.026 0 0 0 636.151 19.426 A 16.024 16.024 0 0 0 636.15 19.567 Q 636.15 21.96 636.869 24.041 A 12.367 12.367 0 0 0 638.086 26.581 A 13.963 13.963 0 0 0 643.449 31.535 A 15.449 15.449 0 0 0 649.406 33.271 A 18.894 18.894 0 0 0 651.101 33.346 Z" />
					</g>
				</svg>
			</a>
			<div className={cx(style.buttonWrapper, isOpen && style.open)}>
				<button type="button" className={style.svgButton} onClick={handleCopy}>
					<span className={style.svgButtonLabel}>Copy E-Mail address</span>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="none"
						stroke="currentColor"
						viewBox="0 0 24 24"
					>
						<path stroke="none" d="M0 0h24v24H0z" />
						<path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2" />
						<rect width="6" height="4" x="9" y="3" rx="2" />
					</svg>
				</button>
				<button type="button" className={style.svgButton} onClick={handleWrite}>
					<span className={style.svgButtonLabel}>Write E-Mail</span>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="none"
						stroke="currentColor"
						viewBox="0 0 24 24"
					>
						<path stroke="none" d="M0 0h24v24H0z" />
						<path d="M5 4h4l2 5-2.5 1.5a11 11 0 0 0 5 5L15 13l5 2v4a2 2 0 0 1-2 2A16 16 0 0 1 3 6a2 2 0 0 1 2-2" />
					</svg>
				</button>
			</div>
		</span>
	);
};

export default Tel;
